clc;
clear;
close all;

%% Sentinel-2 MS image simulation by the means of HSI
addpath('Functions');

I = double(imread('19920612_AVIRIS_IndianPine_Site3.tif'));
[m,n,z]=size(I);

I2d=hyperConvert2d(I);
ind=isnan(I2d);I2d(ind==1)=0; 

load('sentinel2.txt');

wavelengthHS = 1000 * [0.383150, 0.392840, 0.402540, 0.412250, 0.421980, 0.431710, 0.441460,0.451220, 0.460990, 0.470760, 0.480550, 0.490340, 0.500140, 0.509950,0.519760, 0.529580, 0.539400, 0.549230, 0.559070, 0.568900, 0.578740,0.588580, 0.598430, 0.608270, 0.618110, 0.627960, 0.637800, 0.647650,0.657490, 0.667330, 0.677170, 0.687000, 0.663300, 0.672870, 0.682440,0.692020, 0.701590, 0.711170, 0.720750, 0.730340, 0.739920, 0.749510,0.759090, 0.768680, 0.778270, 0.787870, 0.797460, 0.807050, 0.816650,0.826250, 0.835850, 0.845450, 0.855050, 0.864650, 0.874250, 0.883850,0.893460, 0.903060, 0.912670, 0.922270, 0.931880, 0.941490, 0.951090,0.960700, 0.970310, 0.979920, 0.989530, 0.999130, 1.008700, 1.018300,1.028000, 1.037600, 1.047200, 1.056800, 1.066400, 1.076000, 1.085600,1.095200, 1.104800, 1.114400, 1.124000, 1.133600, 1.143200, 1.152800,1.162400, 1.172000, 1.181600, 1.191200, 1.200800, 1.210400, 1.220000,1.229600, 1.239200, 1.248800, 1.258400, 1.268000, 1.252900, 1.262800,1.272800, 1.282800, 1.292700, 1.302700, 1.312600, 1.322600, 1.332600,1.342500, 1.352500, 1.362400, 1.372400, 1.382400, 1.392300, 1.402300,1.412200, 1.422200, 1.432200, 1.442100, 1.452100, 1.462000, 1.472000,1.481900, 1.491900, 1.501900, 1.511800, 1.521800, 1.531700, 1.541700,1.551700, 1.561600, 1.571600, 1.581500, 1.591500, 1.601400, 1.611400,1.621300, 1.631300, 1.641200, 1.651200, 1.661200, 1.671100, 1.681100,1.691000, 1.701000, 1.710900, 1.720900, 1.730800, 1.740800, 1.750700,1.760700, 1.770600, 1.780600, 1.790500, 1.800500, 1.810400, 1.820400,1.830300, 1.840300, 1.850200, 1.860200, 1.870100, 1.880100, 1.880400,1.890400, 1.900500, 1.910600, 1.920600, 1.930600, 1.940700, 1.950700,1.960800, 1.970800, 1.980800, 1.990800, 2.000900, 2.010900, 2.020900,2.030900, 2.040900, 2.050900, 2.060900, 2.071000, 2.081000, 2.091000,2.101000, 2.111000, 2.121000, 2.130900, 2.140900, 2.150900, 2.160900,2.170900, 2.180900, 2.190800, 2.200800, 2.210800, 2.220800, 2.230700,2.240700, 2.250600, 2.260600, 2.270600, 2.280500, 2.290400, 2.300400,2.310400, 2.320300, 2.330200, 2.340200, 2.350100, 2.360000, 2.370000,2.379900, 2.389800, 2.399700, 2.409600, 2.419600, 2.429500, 2.439400,2.449300, 2.459200, 2.469100];

SRFs4 = sentinel2(:, 2 : 11);
wavelengthMS = sentinel2(:, 1);
SRFs4HS = hyperResample(SRFs4, wavelengthMS, wavelengthHS );
SRFs4HS_Normalized = SRFs4HS./repmat(sum(SRFs4HS), 220, 1);

MS2d = zeros(10, size(I2d, 2));
MS3d = zeros(m, n, 10);
for i = 1 : 10
    MS2d(i, :) = SRFs4HS_Normalized(:, i)' * I2d;
    MS3d(:, :, i) = hyperConvert3d(MS2d(i, :), m, n, 1);
end
data_MS_HR = MS3d;